<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Caesar Cipher - Mã hóa / Giải mã (HTML + JS)</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      max-width: 900px;
      margin: 24px auto;
      padding: 12px;
      line-height: 1.5;
      color: #111;
    }
    h1 { margin-bottom: 6px; }
    label { display:block; margin-top:12px; font-weight:600; }
    textarea { width:100%; min-height:80px; padding:8px; font-family: monospace; }
    input[type="number"] { width:120px; padding:6px; }
    .row { display:flex; gap:12px; align-items:center; margin-top:8px; flex-wrap:wrap; }
    button { padding:8px 12px; cursor:pointer; border-radius:6px; border:1px solid #bbb; background:#f5f5f5; }
    .output { background:#f8f8f8; padding:10px; border-radius:6px; margin-top:8px; white-space:pre-wrap; font-family: monospace; }
    .code-block { margin-top:20px; background:#222; color:#eee; padding:12px; border-radius:6px; overflow:auto; }
    .note { font-size:0.95rem; color:#444; margin-top:8px; }
  </style>
</head>
<body>
  <h1>Caesar Cipher — Mã hóa và Giải mã</h1>
  <p>Phiên bản web dựa trên đoạn code C++ bạn cung cấp. Giữ nguyên các thông báo tiếng Việt như trong code.</p>

  <!-- Mã hóa -->
  <section>
    <h2>Mã hóa</h2>
    <label for="plaintext">Nhap ban ro:</label>
    <textarea id="plaintext" placeholder="Nhập bản rõ (plaintext) ở đây...">Hello World</textarea>

    <div class="row">
      <label for="keyEncrypt">Nhap khoa k (so buoc dich chuyen):</label>
      <input id="keyEncrypt" type="number" value="3" />
      <button id="btnEncrypt">Mã hóa</button>
    </div>

    <div class="note">==&gt; Ban ma:</div>
    <div id="ciphertextOut" class="output"></div>
  </section>

  <!-- Giải mã -->
  <section>
    <h2>Giải mã</h2>
    <label for="ciphertext">Nhap ban ma de giai ma:</label>
    <textarea id="ciphertext" placeholder="Nhập bản mã (ciphertext) ở đây..."></textarea>

    <div class="row">
      <label for="keyDecrypt">Nhap khoa k de giai ma:</label>
      <input id="keyDecrypt" type="number" value="3" />
      <button id="btnDecrypt">Giải mã</button>
    </div>

    <div class="note">==&gt; Ban ro sau giai ma:</div>
    <div id="plaintextOut" class="output"></div>
  </section>

  <!-- Hiển thị đoạn code C++ gốc (tham khảo) -->
  <section>
    <h2>Đoạn code C++ gốc (tham khảo)</h2>
    <pre class="code-block">
// Hàm mã hóa Caesar
string encryptCaesar(string text, int key) {
    string result = "";
    for (int i = 0; i < text.length(); i++) {
        char c = text[i];
        if (isupper(c)) {
            result += char((c - 'A' + key) % 26 + 'A');
        } else if (islower(c)) {
            result += char((c - 'a' + key) % 26 + 'a');
        } else {
            result += c; 
        }
    }
    return result;
}

// Hàm giải mã Caesar
string decryptCaesar(string text, int key) {
    string result = "";
    for (int i = 0; i < text.length(); i++) {
        char c = text[i];
        if (isupper(c)) {
            result += char((c - 'A' - key + 26) % 26 + 'A');
        } else if (islower(c)) {
            result += char((c - 'a' - key + 26) % 26 + 'a');
        } else {
            result += c;
        }
    }
    return result;
}
    </pre>
  </section>

  <script>
    // Hàm helper: xử lý modulo đúng cho số âm
    function mod(n, m) {
      return ((n % m) + m) % m;
    }

    // Hàm mã hóa (giữ nguyên logic C++)
    function encryptCaesar(text, key) {
      let result = '';
      const k = Number(key) || 0;
      for (let i = 0; i < text.length; i++) {
        const c = text[i];
        if (c >= 'A' && c <= 'Z') {
          const base = 'A'.charCodeAt(0);
          const code = ((c.charCodeAt(0) - base + k) % 26) + base;
          result += String.fromCharCode(code);
        } else if (c >= 'a' && c <= 'z') {
          const base = 'a'.charCodeAt(0);
          const code = ((c.charCodeAt(0) - base + k) % 26) + base;
          result += String.fromCharCode(code);
        } else {
          result += c; // giữ nguyên ký tự không phải chữ
        }
      }
      return result;
    }

    // Hàm giải mã (giữ nguyên logic C++)
    function decryptCaesar(text, key) {
      let result = '';
      const k = Number(key) || 0;
      for (let i = 0; i < text.length; i++) {
        const c = text[i];
        if (c >= 'A' && c <= 'Z') {
          const base = 'A'.charCodeAt(0);
          const code = mod((c.charCodeAt(0) - base - k), 26) + base;
          result += String.fromCharCode(code);
        } else if (c >= 'a' && c <= 'z') {
          const base = 'a'.charCodeAt(0);
          const code = mod((c.charCodeAt(0) - base - k), 26) + base;
          result += String.fromCharCode(code);
        } else {
          result += c;
        }
      }
      return result;
    }

    // DOM
    const plaintextEl = document.getElementById('plaintext');
    const keyEncryptEl = document.getElementById('keyEncrypt');
    const btnEncrypt = document.getElementById('btnEncrypt');
    const ciphertextOut = document.getElementById('ciphertextOut');

    const ciphertextEl = document.getElementById('ciphertext');
    const keyDecryptEl = document.getElementById('keyDecrypt');
    const btnDecrypt = document.getElementById('btnDecrypt');
    const plaintextOut = document.getElementById('plaintextOut');

    // Mã hóa: lấy plaintext + key -> hiển thị ciphertext
    btnEncrypt.addEventListener('click', () => {
      const pt = plaintextEl.value;
      const k = parseInt(keyEncryptEl.value, 10) || 0;
      const cipher = encryptCaesar(pt, k);
      ciphertextOut.textContent = cipher;
      // tự động gợi ý điền phần giải mã với bản mã vừa tạo
      ciphertextEl.value = cipher;
      keyDecryptEl.value = k;
    });

    // Giải mã: lấy ciphertext + key -> hiển thị plaintext
    btnDecrypt.addEventListener('click', () => {
      const ct = ciphertextEl.value;
      const k = parseInt(keyDecryptEl.value, 10) || 0;
      const dec = decryptCaesar(ct, k);
      plaintextOut.textContent = dec;
    });

    // Khi trang load: chạy mã hóa mẫu để hiển thị kết quả
    window.addEventListener('load', () => {
      btnEncrypt.click();
    });
  </script>
</body>
</html>
